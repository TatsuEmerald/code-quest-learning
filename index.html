<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeQuest: Steady Success</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body { background: #0f172a; overflow: hidden; color: white; font-family: sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .neon-text { text-shadow: 0 0 10px rgba(34, 211, 238, 0.8); }
        .code-font { font-family: 'Fira Code', monospace; }
        textarea { resize: none; spellcheck: false; }
        .mascot-on-map { width: 130px; position: absolute; bottom: 52%; left: 50%; transform: translateX(-50%); z-index: 5; pointer-events: none; }
        .nav-btn { background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.2); width: 50px; height: 50px; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.2s; cursor: pointer; pointer-events: auto; }
        .nav-btn:hover { background: rgba(34, 211, 238, 0.3); border-color: cyan; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center">
    <div id="app-container" class="w-full flex items-center justify-center p-4"></div>

    <script>
        // ==========================================
        // LANDMARK 1: THE CHAPTER VAULT 
        // ==========================================
        const CHAPTER_VAULT = {
            1: { ch: 1, title: "The Message", goal: "Hello World", explain: "Text in code is called a 'String'." },
            2: { ch: 1, title: "The Quotes", goal: "\"Hello World\"", explain: "Quotes tell the computer: 'This is a word'." },
            3: { ch: 1, title: "The Shield", goal: "(\"Hello World\")", explain: "Parentheses hold data for functions." },
            4: { ch: 1, title: "The Voice", goal: "console.log(\"Hello World\")", explain: "log makes the computer speak!" },
            5: { ch: 1, title: "CHAPTER 1 EXAM", goal: "console.log(\"Hello World\")", type: "quiz", explain: "Speak 'Hello World' from memory." },
            6: { ch: 2, title: "The Value", goal: "10", explain: "Numbers don't need quotes!" },
            7: { ch: 2, title: "The Assignment", goal: "power = 10", explain: "The '=' sign stores data into a name." },
            8: { ch: 2, title: "The Box", goal: "let power = 10", explain: "'let' creates a brand new variable." },
            9: { ch: 2, title: "Peeking Inside", goal: "console.log(power)", explain: "No quotes needed to peek inside a variable!" },
            10: { ch: 2, title: "CHAPTER 2 EXAM", goal: "let power = 10", type: "quiz", explain: "Store 10 in a box named 'power'." },
            11: { ch: 3, title: "Addition", goal: "power + 5", explain: "Use '+' to increase a value." },
            12: { ch: 3, title: "Subtraction", goal: "power - 2", explain: "Use '-' to decrease a value." },
            13: { ch: 3, title: "Multiplication", goal: "power * 2", explain: "In code, '*' means multiply." },
            14: { ch: 3, title: "Update Box", goal: "power = 20", explain: "No 'let' needed to update an old box." },
            15: { ch: 3, title: "Total Math", goal: "let total = 5 + 5", explain: "Do math and save it in a new box." },
            16: { ch: 3, title: "Health Loss", goal: "let health = 10 - 2", explain: "Create 'health' using subtraction." },
            17: { ch: 3, title: "Double DMG", goal: "let damage = 5 * 2", explain: "Create 'damage' using multiplication." },
            18: { ch: 3, title: "Mixed Math", goal: "total = power + 5", explain: "Add a variable and a number together." },
            19: { ch: 3, title: "Alchemist", goal: "final = power + total", explain: "Add two variables to get a result." },
            20: { ch: 3, title: "CHAPTER 3 EXAM", goal: "let final = power + 5", type: "quiz", explain: "Create 'final' using 'power' + 5." },
            21: { ch: 4, title: "The Evaluation", goal: "power > 5", explain: "The '>' symbol evaluates if the left is greater than the right." },
            22: { ch: 4, title: "The Condition", goal: "if (power > 5)", explain: "An 'if' statement runs code only if the result is true." },
            23: { ch: 4, title: "The Truth", goal: "true", explain: "When a comparison is correct, the result is a Boolean value. Type true (with NO QUOTES) to see the raw result of a successful evaluation." },
            24: { ch: 4, title: "The Lie", goal: "false", explain: "If a comparison is wrong, the computer results in 'false'." },
            25: { ch: 4, title: "The Less-Than", goal: "health < 5", explain: "The '<' symbol evaluates if the left is less than the right." },
            26: { ch: 4, title: "Strict Equality", goal: "power === 10", explain: "Use '===' to evaluate if values are exactly equal." },
            27: { ch: 4, title: "The Alternative", goal: "else", explain: "'else' handles what to do when the 'if' is false." },
            28: { ch: 4, title: "Opening {", goal: "{", explain: "The '{' starts a list of actions for the Gate." },
            29: { ch: 4, title: "Closing }", goal: "}", explain: "The '}' ends the list of actions." },
            30: { ch: 4, title: "CHAPTER 4 EXAM", goal: "if (power > 5)", type: "quiz", explain: "Write an 'if' gate to check if power is > 5." },

            // --- CHAPTER 5: THE LOOP SPIRAL ---
            31: { ch: 5, title: "The Repeat", goal: "for", explain: "A 'for' loop tells the computer to repeat an action. It's the engine of automation!" },
            32: { ch: 5, title: "The Counter", goal: "let i = 0", explain: "Loops need a counter to track laps. We usually start at 0 using 'let i = 0'." },
            33: { ch: 5, title: "The Limit", goal: "i < 10", explain: "The loop needs a stop sign. This checks if the counter is still under the limit." },
            34: { ch: 5, title: "The Step", goal: "i++", explain: "The 'i++' command adds 1 to the counter every time the loop finishes a lap." },
            35: { ch: 5, title: "The Full Loop", goal: "for (let i = 0; i < 5; i++)", explain: "Let's build the full loop header! Start at 0, stop at 5, count by 1s." },
            36: { ch: 5, title: "Loop Body", goal: "{", explain: "Just like 'if' gates, loops use '{' to hold the actions being repeated." },
            37: { ch: 5, title: "Loop Action", goal: "console.log(i)", explain: "Let's print the counter inside the loop to see it count in the console!" },
            38: { ch: 5, title: "Loop Closure", goal: "}", explain: "Close the loop block with '}' to finish the repeating spell." },
            39: { ch: 5, title: "Infinite Danger", goal: "i++", explain: "If you forget to increase the counter (i++), the loop never ends and crashes the program!" },
            40: { ch: 5, title: "CHAPTER 5 EXAM", goal: "for (let i = 0; i < 10; i++)", type: "quiz", explain: "RECALL: Write a loop header that counts from 0 to 10." },

            // --- CHAPTER 6: THE LOGIC ARRAY ---
            41: { ch: 6, title: "The List", goal: "[ ]", explain: "An Array is a list of items. We use square brackets [ ] to create one." },
            42: { ch: 6, title: "Inventory", goal: "['Sword', 'Shield']", explain: "Words in a list still need quotes! Separate items with a comma." },
            43: { ch: 6, title: "Storing Lists", goal: "let items = ['Sword', 'Shield']", explain: "You can store a whole list into a single variable box!" },
            44: { ch: 6, title: "The Index", goal: "0", explain: "Computers start counting lists at 0. The first item is always at spot 0." },
            45: { ch: 6, title: "Grabbing Items", goal: "items[0]", explain: "To get the first item, use the list name and the index in brackets." },
            46: { ch: 6, title: "List Length", goal: "items.length", explain: "The '.length' command tells you how many items are in the list." },
            47: { ch: 6, title: "Adding Items", goal: "items.push('Potion')", explain: "Use '.push' to add a new item to the end of your list." },
            48: { ch: 6, title: "Removing Items", goal: "items.pop()", explain: "Use '.pop' to remove the very last item from the list." },
            49: { ch: 6, title: "Changing Items", goal: "items[0] = 'Axe'", explain: "You can overwrite an item by assigning a new value to its index." },
            50: { ch: 6, title: "CHAPTER 6 EXAM", goal: "items[1]", type: "quiz", explain: "RECALL: How do you grab the SECOND item in the 'items' list?" },

            // --- CHAPTER 7: THE FUNCTION FORGE ---
            51: { ch: 7, title: "The Spellbook", goal: "function", explain: "A Function is a saved block of code you can use over and over." },
            52: { ch: 7, title: "Naming Spells", goal: "function castSpell()", explain: "Give your function a name followed by (). This is where it's defined." },
            53: { ch: 7, title: "Spell Body", goal: "{", explain: "Functions use curly brackets to hold the actions they perform." },
            54: { ch: 7, title: "The Action", goal: "console.log('ZAP!')", explain: "Let's put a log inside our function so it speaks when used." },
            55: { ch: 7, title: "The Closure", goal: "}", explain: "Finish your function definition with a closing bracket." },
            56: { ch: 7, title: "The Call", goal: "castSpell()", explain: "To actually use the spell, type its name with (). This is 'calling' it." },
            57: { ch: 7, title: "Reuse", goal: "castSpell()", explain: "Call it again! That's the power of functions‚Äîwrite once, use forever." },
            58: { ch: 7, title: "Organization", goal: "function", explain: "Functions help keep your code clean by grouping actions together." },
            59: { ch: 7, title: "Order Matters", goal: "function", explain: "You usually define a function at the top so you can call it later." },
            60: { ch: 7, title: "CHAPTER 7 EXAM", goal: "castSpell()", type: "quiz", explain: "RECALL: How do you 'call' a function named castSpell?" },

            // --- CHAPTER 8: THE PARAMETER BRIDGE ---
            61: { ch: 8, title: "The Input", goal: "(name)", explain: "Parameters are values you send INTO a function. Put a name in the ( )." },
            62: { ch: 8, title: "Multiple Inputs", goal: "(name, power)", explain: "You can send multiple pieces of data by using a comma." },
            63: { ch: 8, title: "Using Inputs", goal: "console.log(name)", explain: "Inside the function, you use the parameter name like a variable." },
            64: { ch: 8, title: "The Setup", goal: "function greet(name)", explain: "Let's create a function that takes a name as an input." },
            65: { ch: 8, title: "Sending Data", goal: "greet('Cinder')", explain: "When you call the function, put the actual data in the ( )." },
            66: { ch: 8, title: "Data Match", goal: "greet", explain: "The value 'Cinder' gets teleported into the 'name' parameter." },
            67: { ch: 8, title: "Flexibility", goal: "greet('Sparkle')", explain: "Now the same function can greet someone else just by changing the input!" },
            68: { ch: 8, title: "Math Inputs", goal: "function add(a, b)", explain: "Functions can take numbers as parameters to do math." },
            69: { ch: 8, title: "The Math Call", goal: "add(5, 10)", explain: "Send two numbers into the 'add' function." },
            70: { ch: 8, title: "CHAPTER 8 EXAM", goal: "function blast(power)", type: "quiz", explain: "Create a function 'blast' that takes one parameter called 'power'." },

            // --- CHAPTER 9: THE RETURN PORTAL ---
            71: { ch: 9, title: "The Result", goal: "return", explain: "The 'return' keyword sends a value BACK from a function to where it was called." },
            72: { ch: 9, title: "The Hand-off", goal: "return total", explain: "This sends the contents of the 'total' box out of the function." },
            73: { ch: 9, title: "The Exit", goal: "return", explain: "When a function hits 'return', it stops immediately. It's the exit door." },
            74: { ch: 9, title: "Saving Returns", goal: "let result = add(5, 5)", explain: "You can catch a returned value and store it in a new variable!" },
            75: { ch: 9, title: "The Calculation", goal: "return a + b", explain: "You can return the result of a math problem directly." },
            76: { ch: 9, title: "The Checker", goal: "return true", explain: "Functions can also return Booleans to tell you if a check passed." },
            77: { ch: 9, title: "The Logic Return", goal: "return", explain: "Imagine a function 'isAlive' that returns true or false." },
            78: { ch: 9, title: "No Return", goal: "undefined", explain: "If a function has no return, it gives back 'undefined' (nothing)." },
            79: { ch: 9, title: "Multiple Returns", goal: "if", explain: "You can use 'if' to return different things in different situations." },
            80: { ch: 9, title: "CHAPTER 9 EXAM", goal: "return power", type: "quiz", explain: "RECALL: What keyword sends a value out of a function?" },

            // --- CHAPTER 10: THE MASTER EXAM ---
            81: { ch: 10, title: "Review: Variables", goal: "let energy = 100", explain: "Final Review! Create your energy box." },
            82: { ch: 10, title: "Review: Math", goal: "energy = energy - 10", explain: "Reduce your energy by 10." },
            83: { ch: 10, title: "Review: Arrays", goal: "let pouch = []", explain: "Create an empty inventory pouch list." },
            84: { ch: 10, title: "Review: Push", goal: "pouch.push('Gem')", explain: "Put a Gem in your pouch." },
            85: { ch: 10, title: "Review: Loops", goal: "for (let i = 0; i < 3; i++)", explain: "Start a loop that runs 3 times." },
            86: { ch: 10, title: "Review: Ifs", goal: "if (energy > 0)", explain: "Check if you still have energy." },
            87: { ch: 10, title: "Review: Functions", goal: "function play()", explain: "Define the main game function." },
            88: { ch: 10, title: "Review: Params", goal: "function heal(amt)", explain: "Define a heal function with an amount." },
            89: { ch: 10, title: "Review: Returns", goal: "return health", explain: "Return the final health value." },
            90: { ch: 10, title: "FINAL CHALLENGE", goal: "console.log('Master')", type: "quiz", explain: "Speak your final rank: 'Master'" }

            // --- CHAPTER 11: THE DATA OBJECT ---
            91: { ch: 11, title: "The Object", goal: "{ }", explain: "Objects use curly brackets { } to group related data together into one unit." },
            92: { ch: 11, title: "Key and Value", goal: "name: 'Cinder'", explain: "Inside objects, we use a 'key' and a 'value' separated by a colon (:)." },
            93: { ch: 11, title: "Grouping Data", goal: "{ name: 'Cinder', lvl: 1 }", explain: "Separate different pieces of data with a comma inside the brackets." },
            94: { ch: 11, title: "Storing Objects", goal: "let hero = { hp: 100 }", explain: "You can store a whole object into a variable name like 'hero'." },
            95: { ch: 11, title: "Dot Notation", goal: "hero.hp", explain: "To 'peek' inside an object, use a dot. 'hero.hp' gets the value of hp." },
            96: { ch: 11, title: "Updating Objects", goal: "hero.hp = 90", explain: "Use the dot to change a value inside. This reduces the hero's hp to 90." },
            97: { ch: 11, title: "Adding Keys", goal: "hero.mp = 50", explain: "You can add a brand new category (mp) just by using the dot and assigning a value." },
            98: { ch: 11, title: "Nested Objects", goal: "hero.stats.atk", explain: "Objects can live inside objects! This is how complex game data is organized." },
            99: { ch: 11, title: "The Inventory Link", goal: "hero.items = []", explain: "You can even put an Array (list) inside an object key!" },
            100: { ch: 11, title: "CHAPTER 11 EXAM", goal: "hero.hp", type: "quiz", explain: "RECALL: How do you access the 'hp' value inside the 'hero' object?" }
        }; // <--- THIS IS THE CLOSING BRACKET FOR THE VAULT

        // ==========================================
        // LANDMARK 2: THE GAME ENGINE
        // ==========================================
        const firebaseConfig = {
          apiKey: "AIzaSyAKbMQ9rNalDV6p0pJSpIy84EthjLeGwig",
          authDomain: "codequest-c1da5.firebaseapp.com",
          projectId: "codequest-c1da5",
          storageBucket: "codequest-c1da5.firebasestorage.app",
          messagingSenderId: "726116988970",
          appId: "1:726116988970:web:e8681978587c9d36a3eb53"
        };
        const firebaseConfig = {
          apiKey: "AIzaSyAKbMQ9rNalDV6p0pJSpIy84EthjLeGwig",
          authDomain: "codequest-c1da5.firebaseapp.com",
          projectId: "codequest-c1da5",
          storageBucket: "codequest-c1da5.firebasestorage.app",
          messagingSenderId: "726116988970",
          appId: "1:726116988970:web:e8681978587c9d36a3eb53"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let userData = { mascot: "", language: "", currentLevel: 1, coins: 0 };
        let viewingLevel = 1;

        window.onload = () => {
            document.getElementById('app-container').innerHTML = `<div class="glass p-8 rounded-[2.5rem] text-center max-w-md w-full border-t-4 border-cyan-400"><h1 class="text-5xl font-black mb-8 text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-fuchsia-500">CodeQuest</h1><button onclick="login()" class="w-full bg-white text-slate-900 font-black py-4 rounded-2xl">CONTINUE WITH GOOGLE</button></div>`;
        };

        function login() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then(res => {
                db.collection("users").doc(res.user.uid).get().then(doc => {
                    if (doc.exists && doc.data().setupComplete) { userData = doc.data(); viewingLevel = userData.currentLevel; goToMap(); } 
                    else renderMascotChoice();
                });
            });
        }

        function renderMascotChoice() {
            document.getElementById('app-container').innerHTML = `<div class="text-center w-full max-w-4xl"><h2 class="text-4xl font-black mb-8">SELECT PARTNER</h2><div class="grid grid-cols-2 gap-8"><div onclick="finishSetup('dragon')" class="glass p-6 rounded-[2rem] cursor-pointer"><img src="dragon.png" class="w-64 mx-auto mb-4"><p class="text-2xl font-black text-cyan-400">CINDER</p></div><div onclick="finishSetup('unicorn')" class="glass p-6 rounded-[2rem] cursor-pointer"><img src="unicorn.png" class="w-64 mx-auto mb-4"><p class="text-2xl font-black text-fuchsia-400">SPARKLE</p></div></div></div>`;
        }

        function finishSetup(m) {
            userData.mascot = m;
            document.getElementById('app-container').innerHTML = `<div class="text-center max-w-lg w-full"><h2 class="text-4xl font-black mb-8">CHOOSE LANGUAGE</h2><button onclick="saveLang('JavaScript')" class="w-full bg-yellow-400 text-slate-900 font-black py-5 rounded-2xl mb-4">JAVASCRIPT</button><button onclick="saveLang('Python')" class="w-full bg-blue-500 text-white font-black py-5 rounded-2xl">PYTHON</button></div>`;
        }

        function saveLang(l) {
            userData.language = l; userData.currentLevel = 1; viewingLevel = 1;
            db.collection("users").doc(auth.currentUser.uid).set({ mascot: userData.mascot, chosenLanguage: l, currentLevel: 1, coins: 0, setupComplete: true }, { merge: true }).then(goToMap);
        }

        function goToMap() {
            const lsn = CHAPTER_VAULT[viewingLevel] || { title: "COMING SOON", ch: 0 };
            const chLvl = Object.values(CHAPTER_VAULT).filter(l => l.ch === lsn.ch);
            const start = Math.min(...Object.keys(CHAPTER_VAULT).filter(k => CHAPTER_VAULT[k].ch === lsn.ch));
            const pct = ((viewingLevel - start + 1) / (chLvl.length || 1)) * 100;
            document.getElementById('app-container').innerHTML = `<div class="relative w-full max-w-6xl aspect-video bg-contain bg-center bg-no-repeat rounded-[3rem] border-4 border-white/10 shadow-2xl overflow-hidden" style="background-image: url('map.png'); background-color: #0f172a;"><img src="${userData.mascot}.png" class="mascot-on-map"><div class="absolute inset-x-12 top-1/2 -translate-y-1/2 flex justify-between z-30 pointer-events-none"><button onclick="viewDir(-1)" class="nav-btn ${viewingLevel > 1 ? 'pointer-events-auto' : 'opacity-0'}">‚¨ÖÔ∏è</button><button onclick="viewDir(1)" class="nav-btn ${viewingLevel < userData.currentLevel ? 'pointer-events-auto' : 'opacity-0'}">‚û°Ô∏è</button></div><div class="absolute bottom-0 left-0 w-full h-24 bg-slate-900/90 flex items-center px-12 justify-between z-20"><div class="flex items-center gap-6"><img src="${userData.mascot}.png" class="w-16 h-16 object-contain bg-cyan-500/10 rounded-full border border-cyan-400"><div><p class="text-[10px] text-slate-500 font-bold uppercase">Chapter ${lsn.ch} - ${Math.round(pct)}%</p><p class="text-2xl font-black">Level ${viewingLevel}</p></div></div><div class="flex items-center gap-8"><div class="text-2xl font-black text-yellow-400">üü° ${userData.coins || 0}</div><button onclick="startQuest()" class="bg-cyan-400 text-slate-900 px-10 py-4 rounded-full font-black text-lg">START QUEST</button></div></div><div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 translate-x-16 text-center z-30"><div class="w-24 h-24 bg-cyan-500 rounded-full animate-bounce border-4 border-white flex items-center justify-center font-black text-4xl">${viewingLevel}</div><p class="mt-4 font-black neon-text uppercase">${lsn.title}</p></div></div>`;
        }

        function viewDir(d) { viewingLevel += d; goToMap(); }

        function startQuest() {
            const l = CHAPTER_VAULT[viewingLevel];
            document.getElementById('app-container').innerHTML = `<div class="glass p-10 rounded-[3rem] w-full max-w-5xl flex flex-col gap-6 border-b-8 ${l.type === 'quiz' ? 'border-red-500' : 'border-cyan-500'}"><div class="flex justify-between items-start"><div class="max-w-xl"><span class="text-xs font-bold text-cyan-400 uppercase">Chapter ${l.ch}</span><h2 class="text-3xl font-black uppercase mb-4">${l.title}</h2><div class="p-4 bg-white/5 rounded-xl border-l-4 border-cyan-400 italic text-slate-200">"${l.explain}"</div></div><img src="${userData.mascot}.png" class="w-24"></div><div class="grid grid-cols-2 gap-8"><div><textarea id="ed" class="w-full h-32 bg-black/90 p-4 text-cyan-300 code-font text-lg rounded-2xl outline-none mb-4" placeholder="// Type here..."></textarea><button onclick="valid()" class="w-full bg-cyan-400 text-slate-900 font-black py-4 rounded-2xl">EXECUTE</button></div><div class="bg-white/5 rounded-[2rem] p-8 text-center flex flex-col justify-center"><p class="text-xs font-bold text-slate-500 mb-2 uppercase">Target Goal:</p>${l.type === 'quiz' ? '<p class="text-xl text-red-400 font-black italic">MEMORY CHALLENGE!</p>' : `<code class="text-2xl font-black">${l.goal}</code>`}</div></div><button onclick="goToMap()" class="text-slate-500 text-xs font-black uppercase mt-4">Exit Quest</button></div>`;
        }

        function valid() {
            const i = document.getElementById('ed').value.trim().replace(/\s/g, "");
            const g = CHAPTER_VAULT[viewingLevel].goal.replace(/\s/g, "");
            if (i === g) {
                if (viewingLevel === userData.currentLevel) {
                    db.collection("users").doc(auth.currentUser.uid).update({ currentLevel: viewingLevel + 1, coins: firebase.firestore.FieldValue.increment(100) }).then(() => { userData.currentLevel++; viewingLevel++; userData.coins += 100; renderSuccess(); });
                } else goToMap();
            } else alert("Try again! Watch your syntax.");
        }

        function renderSuccess() {
            document.getElementById('app-container').innerHTML = `<div class="text-center"><h1 class="text-9xl mb-6">üß†</h1><h2 class="text-5xl font-black uppercase neon-text">SUCCESS!</h2><button onclick="goToMap()" class="mt-10 bg-white text-slate-900 px-16 py-5 rounded-2xl font-black shadow-2xl hover:scale-105 transition-all">CONTINUE</button></div>`;
        }
    </script>
</body>
</html>

